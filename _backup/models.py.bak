from flask_sqlalchemy import SQLAlchemy
from datetime import datetime

# 初始化 SQLAlchemy 實例
db = SQLAlchemy()

# --- 1. 桌位資訊模型 (SeatingTable) ---
class SeatingTable(db.Model):
    table_id = db.Column(db.String(10), primary_key=True)
    zone = db.Column(db.String(50), nullable=False)
    total_seats = db.Column(db.Integer, nullable=False)
    seats_left = db.Column(db.Integer, nullable=False)

    def to_dict(self):
        """用於傳輸 JSON 數據"""
        return {
            "table_id": self.table_id,
            "zone": self.zone,
            "total": self.total_seats,
            "seats_left": self.seats_left
        }

# --- 2. 預訂紀錄模型 (ReservationRecord) ---
class ReservationRecord(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    table_id = db.Column(db.String(10), db.ForeignKey('seating_table.table_id'), nullable=False)
    login_id = db.Column(db.String(50), nullable=False, unique=True) # 📌 Login ID 欄位
    employee_name = db.Column(db.String(100), nullable=False)
    seats_taken = db.Column(db.Integer, nullable=False)
    timestamp = db.Column(db.DateTime, default=datetime.utcnow)
    
    def to_dict(self):
        """將模型物件轉換為字典，用於 JSON 傳輸"""
        return {
            "id": self.id,
            "table_id": self.table_id,
            "login_id": self.login_id,
            "employee_name": self.employee_name,
            "seats_taken": self.seats_taken,
            # 確保時間格式是可讀的字串
            "timestamp": self.timestamp.strftime("%Y-%m-%d %H:%M:%S") 
        }
