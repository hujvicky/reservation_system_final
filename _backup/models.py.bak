from flask_sqlalchemy import SQLAlchemy
from datetime import datetime

# åˆå§‹åŒ– SQLAlchemy å¯¦ä¾‹
db = SQLAlchemy()

# --- 1. æ¡Œä½è³‡è¨Šæ¨¡å‹ (SeatingTable) ---
class SeatingTable(db.Model):
    table_id = db.Column(db.String(10), primary_key=True)
    zone = db.Column(db.String(50), nullable=False)
    total_seats = db.Column(db.Integer, nullable=False)
    seats_left = db.Column(db.Integer, nullable=False)

    def to_dict(self):
        """ç”¨æ–¼å‚³è¼¸ JSON æ•¸æ“š"""
        return {
            "table_id": self.table_id,
            "zone": self.zone,
            "total": self.total_seats,
            "seats_left": self.seats_left
        }

# --- 2. é è¨‚ç´€éŒ„æ¨¡å‹ (ReservationRecord) ---
class ReservationRecord(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    table_id = db.Column(db.String(10), db.ForeignKey('seating_table.table_id'), nullable=False)
    login_id = db.Column(db.String(50), nullable=False, unique=True) # ğŸ“Œ Login ID æ¬„ä½
    employee_name = db.Column(db.String(100), nullable=False)
    seats_taken = db.Column(db.Integer, nullable=False)
    timestamp = db.Column(db.DateTime, default=datetime.utcnow)
    
    def to_dict(self):
        """å°‡æ¨¡å‹ç‰©ä»¶è½‰æ›ç‚ºå­—å…¸ï¼Œç”¨æ–¼ JSON å‚³è¼¸"""
        return {
            "id": self.id,
            "table_id": self.table_id,
            "login_id": self.login_id,
            "employee_name": self.employee_name,
            "seats_taken": self.seats_taken,
            # ç¢ºä¿æ™‚é–“æ ¼å¼æ˜¯å¯è®€çš„å­—ä¸²
            "timestamp": self.timestamp.strftime("%Y-%m-%d %H:%M:%S") 
        }
