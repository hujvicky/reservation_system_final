<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Public Reservation Records</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Styles remain the same for a clean table look */
        body { font-family: 'Inter', sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px;}
        h1 { font-size: 2.5em; font-weight: 700; color: #333; text-align: center; margin-bottom: 30px; }
        .container { max-width: 1200px; margin: 0 auto; background-color: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #e0e0e0; padding: 12px 15px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: bold; color: #555; }
        tbody tr:nth-child(even) { background-color: #f9f9f9; }
        tbody tr:hover { background-color: #e0f2f7; }
        .no-records { text-align: center; color: #777; padding: 20px; font-size: 1.1em; }
        .loading-text { text-align: center; color: #777; padding: 20px; font-size: 1.1em; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Current Reservation Records</h1>
        <p class="text-center mb-4 text-gray-600">This table shows all confirmed reservations.</p>
        
        <!-- 移除篩選按鈕區塊 -->

        <h2 class="text-xl font-bold mb-4">Reservation Details</h2>
        <div id="reservation-list-container">
            <p class="loading-text">Loading reservations...</p>
        </div>
        
        <p class="text-center mt-6 text-sm text-gray-500">
            <a href="/" class="text-indigo-600 hover:text-indigo-800 font-medium">Back to Seating Map</a>
        </p>
    </div>

    <script>
        // ⭐ 新增: 定義基本 URL 以解決 fetch 錯誤 ⭐
        const BASE_URL = window.location.origin;

        document.addEventListener('DOMContentLoaded', () => {
            // 預設請求所有紀錄
            fetchReservations('all'); 
        });

        // 獲取預訂數據的主函數
        async function fetchReservations(filter = 'all') {
            const container = document.getElementById('reservation-list-container');
            container.innerHTML = '<p class="loading-text">Loading reservations...</p>';
            
            // 由於此頁面不篩選，filter=all 即可
            // ⭐ 修正: 使用絕對 URL 呼叫 API ⭐
            const url = `${BASE_URL}/api/reports?filter=all`; 

            try {
                const response = await fetch(url); 
                
                // 檢查是否被重定向 (例如管理員登入保護)
                if (response.redirected) {
                    throw new Error("Redirected to login, check API protection in app.py.");
                }

                const reservations = await response.json();
                renderReservationTable(reservations);
            } catch (error) {
                console.error('Error fetching reservations:', error);
                // 修正錯誤訊息，以區分網路錯誤和 URL 解析錯誤
                container.innerHTML = '<p class="text-red-600">Failed to load reservation data. Please ensure the server is running and the API is accessible.</p>';
            }
        }

        // 渲染表格的函數 (與 Admin 面板結構一致，但無 Action 欄位)
        function renderReservationTable(reservations) {
            const container = document.getElementById('reservation-list-container');
            if (reservations.length === 0) {
                container.innerHTML = '<p class="no-records">No reservation records found yet.</p>';
                return;
            }

            let tableHTML = `
                <table class="min-w-full bg-white">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Table ID</th>
                            <th>Login ID</th>
                            <th>Employee Name</th>
                            <th>Seats Reserved</th>
                            <th>Timestamp (UTC)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            reservations.forEach(res => {
                tableHTML += `
                    <tr>
                        <td>${res.id}</td>
                        <td>${res.table_id}</td>
                        <td>${res.login_id}</td>
                        <td>${res.employee_name}</td>
                        <td>${res.seats_taken}</td> <!-- 數據欄位名稱與後端保持一致 -->
                        <td>${res.timestamp}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;
            container.innerHTML = tableHTML;
        }
    </script>
</body>
</html>
